{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/pages/api/trf2/eproc.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next'\nimport { randomUUID } from 'crypto'\n\n// Store active Puppeteer sessions in memory\nconst sessions = new Map<string, { browser: any; page: any }>()\n\nasync function loadPuppeteer() {\n  // Lazy import so build does not fail when dependency is missing\n  const puppeteer = await import('puppeteer')\n  return puppeteer\n}\n\n/**\n * Initialize a scraping session and return captcha image.\n * GET ?numeroProcesso=0000000\n */\nasync function handleGet(req: NextApiRequest, res: NextApiResponse) {\n  const numero = req.query.numeroProcesso as string\n  if (!numero) {\n    return res.status(400).json({ error: 'Missing numeroProcesso' })\n  }\n\n  const puppeteer = await loadPuppeteer()\n  const browser = await puppeteer.launch({ headless: 'new' })\n  const page = await browser.newPage()\n  // Custom user-agent helps avoid blocks\n  await page.setUserAgent(\n    'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36'\n  )\n\n  // Navigate to the search page\n  await page.goto(\n    'https://eproc-consulta.trf2.jus.br/eproc/externo_controlador.php?acao=processo_consulta_publica'\n  )\n\n  // Fill in process number - selector may change, adjust if needed\n  await page.type('input[name=\"numero\"]', numero)\n\n  // Captcha image element\n  const captchaSelector = '#captcha-img'\n  await page.waitForSelector(captchaSelector, { timeout: 10000 })\n  const captchaElem = await page.$(captchaSelector)\n  if (!captchaElem) {\n    await browser.close()\n    return res.status(500).json({ error: 'Captcha not found' })\n  }\n\n  // Screenshot the captcha to send in base64\n  const captcha = (await captchaElem.screenshot({ encoding: 'base64' })) as string\n\n  const token = randomUUID()\n  sessions.set(token, { browser, page })\n\n  return res.status(200).json({ captcha, token })\n}\n\n/**\n * Submit captcha and extract data.\n * Body: { numeroProcesso, captcha, token }\n */\nasync function handlePost(req: NextApiRequest, res: NextApiResponse) {\n  const { numeroProcesso, captcha, token } = req.body || {}\n  if (!numeroProcesso || !captcha || !token) {\n    return res.status(400).json({ error: 'Missing parameters' })\n  }\n\n  const session = sessions.get(token)\n  if (!session) {\n    return res.status(400).json({ error: 'Invalid session' })\n  }\n\n  const { browser, page } = session\n  try {\n    // Fill captcha - selector may change\n    await page.type('input[name=\"captcha\"]', captcha)\n    await Promise.all([page.waitForNavigation(), page.click('button[type=\"submit\"]')])\n\n    // Wait for table with events - adjust selector if the site changes\n    await page.waitForSelector('#tabelaEventos tbody tr')\n\n    const data = await page.evaluate(() => {\n      const rows = Array.from(\n        document.querySelectorAll('#tabelaEventos tbody tr')\n      )\n      const events = rows.slice(0, 2).map((row) => {\n        const columns = row.querySelectorAll('td')\n        const data = columns[0]?.textContent?.trim() || ''\n        const descricao = columns[1]?.textContent?.trim() || ''\n        return { data, descricao }\n      })\n\n      // Basic information about the process\n      const classe = (document.querySelector('#classe') as HTMLElement)?.innerText || ''\n      const assunto = (document.querySelector('#assunto') as HTMLElement)?.innerText || ''\n      const vara = (document.querySelector('#vara') as HTMLElement)?.innerText || ''\n\n      return { events, info: { classe, assunto, vara } }\n    })\n\n    sessions.delete(token)\n    await browser.close()\n\n    // Summarize with GPT\n    const prompt =\n      'Explique de forma clara e simples para um usuário leigo os dois últimos eventos deste processo judicial: ' +\n      JSON.stringify(data.events)\n\n    const chatRes = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${process.env.OPENAI_API_KEY ?? ''}`,\n      },\n      body: JSON.stringify({\n        model: 'gpt-4o',\n        messages: [{ role: 'user', content: prompt }],\n        max_tokens: 200,\n      }),\n    })\n\n    if (!chatRes.ok) {\n      const text = await chatRes.text()\n      return res.status(chatRes.status).send(text)\n    }\n    const chatData = await chatRes.json()\n    const resumo = chatData.choices?.[0]?.message?.content || ''\n\n    return res.status(200).json({ ...data, resumo })\n  } catch (err) {\n    console.error(err)\n    await browser.close()\n    sessions.delete(token)\n    return res.status(500).json({ error: 'Consulta falhou' })\n  }\n}\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method === 'GET') {\n    return handleGet(req, res)\n  }\n  if (req.method === 'POST') {\n    return handlePost(req, res)\n  }\n  res.setHeader('Allow', ['GET', 'POST'])\n  return res.status(405).end('Method Not Allowed')\n}\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/server/route-modules/pages-api/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/pages-api/module.js')\n} else {\n  if (process.env.NODE_ENV === 'development') {\n    if (process.env.TURBOPACK) {\n      module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.dev.js')\n    } else {\n      module.exports = require('next/dist/compiled/next-server/pages-api.runtime.dev.js')\n    }\n  } else {\n    if (process.env.TURBOPACK) {\n      module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.prod.js')\n    } else {\n      module.exports = require('next/dist/compiled/next-server/pages-api.runtime.prod.js')\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,MAAQ;;AAEzC,OAAO;IACL,IAAIF,QAAQC,GAAG,CAACK,QAAQ,KAAK,WAAe;QAC1C,IAAIN,QAAQC,GAAG,CAACM,SAAS,eAAE;YACzBJ,OAAOC,OAAO,GAAGC,QAAQ;QAC3B,OAAO;;QAEP;IACF,OAAO;;IAMP;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 209, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/server/route-kind.ts"],"sourcesContent":["export const enum RouteKind {\n  /**\n   * `PAGES` represents all the React pages that are under `pages/`.\n   */\n  PAGES = 'PAGES',\n  /**\n   * `PAGES_API` represents all the API routes under `pages/api/`.\n   */\n  PAGES_API = 'PAGES_API',\n  /**\n   * `APP_PAGE` represents all the React pages that are under `app/` with the\n   * filename of `page.{j,t}s{,x}`.\n   */\n  APP_PAGE = 'APP_PAGE',\n  /**\n   * `APP_ROUTE` represents all the API routes and metadata routes that are under `app/` with the\n   * filename of `route.{j,t}s{,x}`.\n   */\n  APP_ROUTE = 'APP_ROUTE',\n\n  /**\n   * `IMAGE` represents all the images that are generated by `next/image`.\n   */\n  IMAGE = 'IMAGE',\n}\n"],"names":["RouteKind"],"mappings":";;;AAAO,IAAWA,YAAAA,WAAAA,GAAAA,SAAAA,SAAAA;IAChB;;GAEC,GAAA,SAAA,CAAA,QAAA,GAAA;IAED;;GAEC,GAAA,SAAA,CAAA,YAAA,GAAA;IAED;;;GAGC,GAAA,SAAA,CAAA,WAAA,GAAA;IAED;;;GAGC,GAAA,SAAA,CAAA,YAAA,GAAA;IAGD;;GAEC,GAAA,SAAA,CAAA,QAAA,GAAA;WAtBeA;MAwBjB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 238, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/build/templates/helpers.ts"],"sourcesContent":["/**\n * Hoists a name from a module or promised module.\n *\n * @param module the module to hoist the name from\n * @param name the name to hoist\n * @returns the value on the module (or promised module)\n */\nexport function hoist(module: any, name: string) {\n  // If the name is available in the module, return it.\n  if (name in module) {\n    return module[name]\n  }\n\n  // If a property called `then` exists, assume it's a promise and\n  // return a promise that resolves to the name.\n  if ('then' in module && typeof module.then === 'function') {\n    return module.then((mod: any) => hoist(mod, name))\n  }\n\n  // If we're trying to hoise the default export, and the module is a function,\n  // return the module itself.\n  if (typeof module === 'function' && name === 'default') {\n    return module\n  }\n\n  // Otherwise, return undefined.\n  return undefined\n}\n"],"names":["hoist","module","name","then","mod","undefined"],"mappings":"AAAA;;;;;;CAMC,GACD;;;AAAO,SAASA,MAAMC,MAAW,EAAEC,IAAY;IAC7C,qDAAqD;IACrD,IAAIA,QAAQD,QAAQ;QAClB,OAAOA,MAAM,CAACC,KAAK;IACrB;IAEA,gEAAgE;IAChE,8CAA8C;IAC9C,IAAI,UAAUD,UAAU,OAAOA,OAAOE,IAAI,KAAK,YAAY;QACzD,OAAOF,OAAOE,IAAI,CAAC,CAACC,MAAaJ,MAAMI,KAAKF;IAC9C;IAEA,6EAA6E;IAC7E,4BAA4B;IAC5B,IAAI,OAAOD,WAAW,cAAcC,SAAS,WAAW;QACtD,OAAOD;IACT;IAEA,+BAA+B;IAC/B,OAAOI;AACT","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/build/templates/pages-api.ts"],"sourcesContent":["import { PagesAPIRouteModule } from '../../server/route-modules/pages-api/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\n\nimport { hoist } from './helpers'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\n\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export config.\nexport const config = hoist(userland, 'config')\n\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesAPIRouteModule({\n  definition: {\n    kind: RouteKind.PAGES_API,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  userland,\n})\n"],"names":["PagesAPIRouteModule","RouteKind","hoist","userland","config","routeModule","definition","kind","PAGES_API","page","pathname","bundlePath","filename"],"mappings":";;;;;AAAA,SAASA,mBAAmB,QAAQ,uDAAsD;AAC1F,SAASC,SAAS,QAAQ,0BAAyB;AAEnD,SAASC,KAAK,QAAQ,YAAW;AAEjC,4BAA4B;AAC5B,YAAYC,cAAc,eAAc;;;;;yMAGzBD,QAAAA,EAAMC,wHAAU,WAAU;AAGlC,MAAMC,2KAASF,QAAAA,EAAMC,wHAAU,UAAS;AAGxC,MAAME,cAAc,qMAAIL,sBAAAA,CAAoB;IACjDM,YAAY;QACVC,8JAAMN,YAAAA,CAAUO,SAAS;QACzBC,MAAM;QACNC,UAAU;QACV,2CAA2C;QAC3CC,YAAY;QACZC,UAAU;IACZ;cACAT;AACF,GAAE","ignoreList":[0],"debugId":null}}]
}