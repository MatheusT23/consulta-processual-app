{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 15, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/pages/api/trf2/eproc.ts"],"sourcesContent":["import type { NextApiRequest, NextApiResponse } from 'next'\n\nasync function loadPuppeteer() {\n  const puppeteer = await import('puppeteer')\n  return puppeteer\n}\n\nasync function solveTurnstile(siteKey: string, pageUrl: string): Promise<string> {\n  const apiKey = process.env.TWOCAPTCHA_API_KEY\n  if (!apiKey) {\n    throw new Error('Missing 2captcha API key')\n  }\n\n  const createRes = await fetch('https://api.2captcha.com/createTask', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      clientKey: apiKey,\n      task: {\n        type: 'TurnstileTaskProxyless',\n        websiteURL: pageUrl,\n        websiteKey: siteKey,\n      },\n    }),\n  })\n  const createData = await createRes.json() as {\n    errorId: number\n    errorDescription?: string\n    taskId?: number\n  }\n  if (createData.errorId !== 0 || !createData.taskId) {\n    throw new Error(createData.errorDescription || 'Failed to create captcha task')\n  }\n  const id = createData.taskId\n\n  while (true) {\n    await new Promise((r) => setTimeout(r, 5000))\n    const res = await fetch('https://api.2captcha.com/getTaskResult', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ clientKey: apiKey, taskId: id }),\n    })\n    const data = await res.json() as {\n      status: 'processing' | 'ready'\n      solution?: { token?: string }\n      errorId?: number\n      errorDescription?: string\n    }\n    if (data.status === 'ready' && data.solution?.token) {\n      return data.solution.token\n    }\n    if (data.status !== 'processing') {\n      throw new Error(data.errorDescription || 'Captcha solving failed')\n    }\n  }\n}\n\nexport default async function handler(req: NextApiRequest, res: NextApiResponse) {\n  if (req.method !== 'POST') {\n    res.setHeader('Allow', ['POST'])\n    return res.status(405).end('Method Not Allowed')\n  }\n\n  const { numeroProcesso } = req.body || {}\n  if (!numeroProcesso) {\n    return res.status(400).json({ error: 'Missing numeroProcesso' })\n  }\n\n  const puppeteer = await loadPuppeteer()\n  const browser = await puppeteer.launch({ headless: 'new' })\n  const page = await browser.newPage()\n  await page.setUserAgent(\n    'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36'\n  )\n\n  await page.goto(\n    'https://eproc-consulta.trf2.jus.br/eproc/externo_controlador.php?acao=processo_consulta_publica'\n  )\n  await page.type('input.infraText', numeroProcesso)\n\n  const siteKey = await page.evaluate(() => {\n    const el = document.querySelector('[data-sitekey]')\n    return el ? (el as HTMLElement).getAttribute('data-sitekey') || '' : ''\n  })\n  const pageUrl = page.url()\n\n  try {\n    const cfToken = await solveTurnstile(siteKey, pageUrl)\n    await page.evaluate((t: string) => {\n      const input = document.querySelector('input[name=\"cf-turnstile-response\"]') as HTMLInputElement | null\n      if (input) input.value = t\n    }, cfToken)\n    \n    await page.click('button[type=\"submit\"]');\nawait page.waitForSelector('#tabelaEventos tbody tr', { timeout: 10000 }); // Wait for the target element\n    //await Promise.all([\n    //page.waitForNavigation({ waitUntil: 'networkidle2', timeout: 60000 }), // Wait until network is idle\n    //page.click('button[type=\"submit\"]'),\n    //])\n    //await page.waitForSelector('#tabelaEventos tbody tr')\n\n    const data = await page.evaluate(() => {\n      const rows = Array.from(document.querySelectorAll('#tabelaEventos tbody tr'))\n      const events = rows.slice(0, 2).map((row) => {\n        const columns = row.querySelectorAll('td')\n        const data = columns[0]?.textContent?.trim() || ''\n        const descricao = columns[1]?.textContent?.trim() || ''\n        return { data, descricao }\n      })\n\n      const classe = (document.querySelector('#classe') as HTMLElement)?.innerText || ''\n      const assunto = (document.querySelector('#assunto') as HTMLElement)?.innerText || ''\n      const vara = (document.querySelector('#vara') as HTMLElement)?.innerText || ''\n\n      return { events, info: { classe, assunto, vara } }\n    })\n\n    await browser.close()\n\n    const prompt =\n      'Explique de forma clara e simples para um usuário leigo os dois últimos eventos deste processo judicial: ' +\n      JSON.stringify(data.events)\n\n    const chatRes = await fetch('https://api.openai.com/v1/chat/completions', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: `Bearer ${process.env.OPENAI_API_KEY ?? ''}`,\n      },\n      body: JSON.stringify({\n        model: 'gpt-4o',\n        messages: [{ role: 'user', content: prompt }],\n        max_tokens: 200,\n      }),\n    })\n\n    if (!chatRes.ok) {\n      const text = await chatRes.text()\n      return res.status(chatRes.status).send(text)\n    }\n    const chatData = await chatRes.json()\n    const resumo = chatData.choices?.[0]?.message?.content || ''\n\n    return res.status(200).json({ ...data, resumo })\n  } catch (err) {\n    console.error(err)\n    await browser.close()\n    return res.status(500).json({ error: 'Consulta falhou' })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 173, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/server/route-modules/pages-api/module.compiled.js"],"sourcesContent":["if (process.env.NEXT_RUNTIME === 'edge') {\n  module.exports = require('next/dist/server/route-modules/pages-api/module.js')\n} else {\n  if (process.env.NODE_ENV === 'development') {\n    if (process.env.TURBOPACK) {\n      module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.dev.js')\n    } else {\n      module.exports = require('next/dist/compiled/next-server/pages-api.runtime.dev.js')\n    }\n  } else {\n    if (process.env.TURBOPACK) {\n      module.exports = require('next/dist/compiled/next-server/pages-api-turbo.runtime.prod.js')\n    } else {\n      module.exports = require('next/dist/compiled/next-server/pages-api.runtime.prod.js')\n    }\n  }\n}\n"],"names":["process","env","NEXT_RUNTIME","module","exports","require","NODE_ENV","TURBOPACK"],"mappings":"AAAA,IAAIA,QAAQC,GAAG,CAACC,YAAY,KAAK,MAAQ;;AAEzC,OAAO;IACL,IAAIF,QAAQC,GAAG,CAACK,QAAQ,KAAK,WAAe;QAC1C,IAAIN,QAAQC,GAAG,CAACM,SAAS,eAAE;YACzBJ,OAAOC,OAAO,GAAGC,QAAQ;QAC3B,OAAO;;QAEP;IACF,OAAO;;IAMP;AACF","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 192, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/server/route-kind.ts"],"sourcesContent":["export const enum RouteKind {\n  /**\n   * `PAGES` represents all the React pages that are under `pages/`.\n   */\n  PAGES = 'PAGES',\n  /**\n   * `PAGES_API` represents all the API routes under `pages/api/`.\n   */\n  PAGES_API = 'PAGES_API',\n  /**\n   * `APP_PAGE` represents all the React pages that are under `app/` with the\n   * filename of `page.{j,t}s{,x}`.\n   */\n  APP_PAGE = 'APP_PAGE',\n  /**\n   * `APP_ROUTE` represents all the API routes and metadata routes that are under `app/` with the\n   * filename of `route.{j,t}s{,x}`.\n   */\n  APP_ROUTE = 'APP_ROUTE',\n\n  /**\n   * `IMAGE` represents all the images that are generated by `next/image`.\n   */\n  IMAGE = 'IMAGE',\n}\n"],"names":["RouteKind"],"mappings":";;;AAAO,IAAWA,YAAAA,WAAAA,GAAAA,SAAAA,SAAAA;IAChB;;GAEC,GAAA,SAAA,CAAA,QAAA,GAAA;IAED;;GAEC,GAAA,SAAA,CAAA,YAAA,GAAA;IAED;;;GAGC,GAAA,SAAA,CAAA,WAAA,GAAA;IAED;;;GAGC,GAAA,SAAA,CAAA,YAAA,GAAA;IAGD;;GAEC,GAAA,SAAA,CAAA,QAAA,GAAA;WAtBeA;MAwBjB","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 221, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/build/templates/helpers.ts"],"sourcesContent":["/**\n * Hoists a name from a module or promised module.\n *\n * @param module the module to hoist the name from\n * @param name the name to hoist\n * @returns the value on the module (or promised module)\n */\nexport function hoist(module: any, name: string) {\n  // If the name is available in the module, return it.\n  if (name in module) {\n    return module[name]\n  }\n\n  // If a property called `then` exists, assume it's a promise and\n  // return a promise that resolves to the name.\n  if ('then' in module && typeof module.then === 'function') {\n    return module.then((mod: any) => hoist(mod, name))\n  }\n\n  // If we're trying to hoise the default export, and the module is a function,\n  // return the module itself.\n  if (typeof module === 'function' && name === 'default') {\n    return module\n  }\n\n  // Otherwise, return undefined.\n  return undefined\n}\n"],"names":["hoist","module","name","then","mod","undefined"],"mappings":"AAAA;;;;;;CAMC,GACD;;;AAAO,SAASA,MAAMC,MAAW,EAAEC,IAAY;IAC7C,qDAAqD;IACrD,IAAIA,QAAQD,QAAQ;QAClB,OAAOA,MAAM,CAACC,KAAK;IACrB;IAEA,gEAAgE;IAChE,8CAA8C;IAC9C,IAAI,UAAUD,UAAU,OAAOA,OAAOE,IAAI,KAAK,YAAY;QACzD,OAAOF,OAAOE,IAAI,CAAC,CAACC,MAAaJ,MAAMI,KAAKF;IAC9C;IAEA,6EAA6E;IAC7E,4BAA4B;IAC5B,IAAI,OAAOD,WAAW,cAAcC,SAAS,WAAW;QACtD,OAAOD;IACT;IAEA,+BAA+B;IAC/B,OAAOI;AACT","ignoreList":[0],"debugId":null}},
    {"offset": {"line": 254, "column": 0}, "map": {"version":3,"sources":["file:///home/matheus/%C3%81rea%20de%20Trabalho/Projetos/consulta-processual-app/node_modules/next/dist/src/build/templates/pages-api.ts"],"sourcesContent":["import { PagesAPIRouteModule } from '../../server/route-modules/pages-api/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\n\nimport { hoist } from './helpers'\n\n// Import the userland code.\nimport * as userland from 'VAR_USERLAND'\n\n// Re-export the handler (should be the default export).\nexport default hoist(userland, 'default')\n\n// Re-export config.\nexport const config = hoist(userland, 'config')\n\n// Create and export the route module that will be consumed.\nexport const routeModule = new PagesAPIRouteModule({\n  definition: {\n    kind: RouteKind.PAGES_API,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    // The following aren't used in production.\n    bundlePath: '',\n    filename: '',\n  },\n  userland,\n})\n"],"names":["PagesAPIRouteModule","RouteKind","hoist","userland","config","routeModule","definition","kind","PAGES_API","page","pathname","bundlePath","filename"],"mappings":";;;;;AAAA,SAASA,mBAAmB,QAAQ,uDAAsD;AAC1F,SAASC,SAAS,QAAQ,0BAAyB;AAEnD,SAASC,KAAK,QAAQ,YAAW;AAEjC,4BAA4B;AAC5B,YAAYC,cAAc,eAAc;;;;;yMAGzBD,QAAAA,EAAMC,wHAAU,WAAU;AAGlC,MAAMC,2KAASF,QAAAA,EAAMC,wHAAU,UAAS;AAGxC,MAAME,cAAc,qMAAIL,sBAAAA,CAAoB;IACjDM,YAAY;QACVC,8JAAMN,YAAAA,CAAUO,SAAS;QACzBC,MAAM;QACNC,UAAU;QACV,2CAA2C;QAC3CC,YAAY;QACZC,UAAU;IACZ;cACAT;AACF,GAAE","ignoreList":[0],"debugId":null}}]
}